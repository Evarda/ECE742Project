\documentclass{article}
\usepackage{amsmath}
\usepackage{mathtools}

\title{ECE 742 Final Project}
\author{
  Michelle King
  \and
  Suraj Suri
  }

\begin{document}
\maketitle
\section{Theory}
\subsection{PML}
Perfectly Matched Layer (PML) boundary conditions are absorbing boundary
conditions. PML BCs decay the wave within a boundary layer at the edge of the
simulation. The edge of the simulation BC can be implemented as PEC.
Well-implemented PML BCs completely decay the wave from the time it enters the
boundary layer to the time after it reflects and attempts to leave.

\subsection{Finite-Difference Derivation}
Let's start with equation:
\begin{equation}\nabla \times \vec{H} = j \omega \epsilon \bar{\bar{s}} \vec{E}\end{equation}
Evaluate the cross product and write in matrix form:
\begin{equation}
  $
  \begin{bmatrix}
    \frac{\partial H_{z}}{\partial y}-\frac{\partial H_{y}}{\partial z} \\
    \frac{\partial H_{x}}{\partial z}-\frac{\partial H_{z}}{\partial x} \\
    \frac{\partial H_{y}}{\partial x}-\frac{\partial H_{x}}{\partial y}
  \end{bmatrix}
  =
  j\omega\epsilon
  \begin{bmatrix}
    \frac{s_{y}s_{z}}{s_{x}} & 0                       & 0                       \\
    0                       & \frac{s_{x}s_{z}}{s_{y}} & 0                       \\
    0                       & 0                       & \frac{s_{x}s_{y}}{s_{z}} \\
  \end{bmatrix}
  \begin{bmatrix}
    E_{x} \\
    E_{y} \\
    E_{z}
  \end{bmatrix}
  $
\end{equation}
Where the values in the second rank tensor can be described by:
\begin{equation}s_{x}=\kappa_{x}+\frac{\sigma_{x}}{j\omega\epsilon_{0}}\end{equation}
\begin{equation}s_{y}=\kappa_{y}+\frac{\sigma_{y}}{j\omega\epsilon_{0}}\label{SyEquation}\end{equation}
\begin{equation}s_{z}=\kappa_{z}+\frac{\sigma_{z}}{j\omega\epsilon_{0}}\label{SzEquation}\end{equation}
To make the calculation computationally more managable, we can define the following
relations:
\begin{equation}D_{x}=\epsilon \frac{s_{z}}{s_{x}}E_{x}\end{equation}
\begin{equation}D_{y}=\epsilon \frac{s_{x}}{s_{y}}E_{y}\end{equation}
\begin{equation}D_{z}=\epsilon \frac{s_{y}}{s_{z}}E_{z}\label{DzEzRelation}\end{equation}
such that now:
\begin{equation}
  $
  \begin{bmatrix}
    \frac{\partial H_{z}}{\partial y}-\frac{\partial H_{y}}{\partial z} \\
    \frac{\partial H_{x}}{\partial z}-\frac{\partial H_{z}}{\partial x} \\
    \frac{\partial H_{y}}{\partial x}-\frac{\partial H_{x}}{\partial y}
  \end{bmatrix}
  =
  j\omega
  \begin{bmatrix}
    s_{y}  & 0      & 0     \\
    0      & s_{z}  & 0     \\
    0      & 0     & s_{x}  \\
  \end{bmatrix}
  \begin{bmatrix}
    D_{x} \\
    D_{y} \\
    D_{z}
  \end{bmatrix}
  $
\end{equation}
Using the defined values of s and that $\frac{\partial}{\partial t} = j \omega $:
\begin{equation}
  $
  \begin{bmatrix}
    \frac{\partial H_{z}}{\partial y}-\frac{\partial H_{y}}{\partial z} \\
    \frac{\partial H_{x}}{\partial z}-\frac{\partial H_{z}}{\partial x} \\
    \frac{\partial H_{y}}{\partial x}-\frac{\partial H_{x}}{\partial y}
  \end{bmatrix}
  $
  =
  \frac{\partial}{\partial t}
  $
  \begin{bmatrix}
    \kappa_{y}  & 0           & 0           \\
    0           & \kappa_{z}  & 0           \\
    0           & 0           & \kappa_{x}  \\
  \end{bmatrix}
  \begin{bmatrix}
    D_{x} \\
    D_{y} \\
    D_{z}
  \end{bmatrix}
  $
  +\frac{1}{\epsilon_{0}}
  $
  \begin{bmatrix}
    \sigma_{y}  & 0           & 0           \\
    0           & \sigma_{z}  & 0           \\
    0           & 0           & \sigma_{x}  \\
  \end{bmatrix}
  \begin{bmatrix}
    D_{x} \\
    D_{y} \\
    D_{z}
  \end{bmatrix}
  $
\end{equation}

This has too much info. Since we are doing 2D, $\kappa_{z}=1$, $\sigma_{z}=0$ in
this simulation. As well as $D_{x}=D_{y}=0$ and $H_{z}=0$. Equation reduces to:

\begin{equation}
  $
  \begin{bmatrix}
    \frac{\partial H_{z}}{\partial y}-\frac{\partial H_{y}}{\partial z} \\
    \frac{\partial H_{x}}{\partial z}-\frac{\partial H_{z}}{\partial x} \\
    \frac{\partial H_{y}}{\partial x}-\frac{\partial H_{x}}{\partial y}
  \end{bmatrix}
  $
  =
  \frac{\partial}{\partial t}
  $
  \begin{bmatrix}
    \kappa_{y}  & 0   & 0          \\
    0           & 1   & 0           \\
    0           & 0   & \kappa_{x}   \\
  \end{bmatrix}
  \begin{bmatrix}
    0 \\
    0 \\
    D_{z}
  \end{bmatrix}
  $
  +\frac{1}{\epsilon_{0}}
  $
  \begin{bmatrix}
    \sigma_{y}  & 0  & 0           \\
    0           & 0  & 0           \\
    0           & 0  & \sigma_{x}   \\
  \end{bmatrix}
  \begin{bmatrix}
    0 \\
    0 \\
    D_{z}
  \end{bmatrix}
  $
\end{equation}

This leaves us with one equation to find an update quation for  $D_{z}$:
\begin{equation}
  \frac{\partial H_{y}}{\partial x}-\frac{\partial H_{x}}{\partial y}=  \kappa_{x}\frac{\partial}{\partial t} D_{z}+\frac{\sigma_{x}}{\epsilon_{0}} D_{z}
\end{equation}


Using semi-implicit (???)

\begin{equation}D^{n+1/2}=\frac{D^{n+1}+D^{n}}{2}\end{equation}

If we discretize around point i,j,k at timestep n

This equation discretizes to:

\begin{equation}
\begin{multlined}
  \frac{1}{\Delta_{x}}(H_{y}^{n+1/2}(i+1/2,j)-H_{y}^{n+1/2}(i-1/2,j)) \\
 -\frac{1}{\Delta_{y}}(H_{x}^{n+1/2}(i,j+1/2)-H_{x}^{n+1/2}(i,j-1/2))= \\
  \frac{\kappa_{x}}{\Delta t}
   (D_{z}^{n+1}(i,j)-D_{z}^{n}(i,j))+
   \frac{\sigma_{x}}{2 \epsilon_{0}}
   (D_{z}^{n+1}(i,j)+D_{z}^{n}(i,j))
\end{multlined}
\end{equation}


 We can solve this to find update equation for D:

\begin{equation}
\begin{multlined}
  \frac{1}{\Delta_{x}}(H_{y}^{n+1/2}(i+1/2,j)-H_{y}^{n+1/2}(i-1/2,j)) \\
 -\frac{1}{\Delta_{y}}(H_{x}^{n+1/2}(i,j+1/2)-H_{x}^{n+1/2}(i,j-1/2))= \\
  (\frac{\sigma_{x}}{2\epsilon_{0}}+\frac{\kappa_{x}}{\Delta t})D_{z}^{n+1}(i,j)+
  (\frac{\sigma_{x}}{2\epsilon_{0}}-\frac{\kappa_{x}}{\Delta t})D_{z}^{n}(i,j)
\end{multlined}
\end{equation}

\begin{equation}
\begin{multlined}
  \frac{1}{\Delta_{x}}(H_{y}^{n+1/2}(i+1/2,j)-H_{y}^{n+1/2}(i-1/2,j)) \\
 -\frac{1}{\Delta_{y}}(H_{x}^{n+1/2}(i,j+1/2)-H_{x}^{n+1/2}(i,j-1/2))= \\
  (\frac{\sigma_{x}\Delta t+2\epsilon_{0}\kappa_{x}}{2\epsilon_{0}\Delta t})D_{z}^{n+1}(i,j)+
  (\frac{\sigma_{x}\Delta t-2\epsilon_{0}\kappa_{x}}{2\epsilon_{0}\Delta t})D_{z}^{n}(i,j)
\end{multlined}
\end{equation}

\begin{equation}
\begin{multlined}
  D_{z}^{n+1}(i,j) = -\frac{\sigma_{x}\Deltat-2\epsilon_{0}\kappa_{x}}{\sigma_{x}\Delta t+2\epsilon_{0}\kappa_{x}}D_{z}^{n}(i,j) \\
  +\frac{2\epsilon_{0}\Delta t}{\Delta_{x}(\sigma_{x}\Delta t+2\epsilon_{0}\kappa_{x})}(H_{y}^{n+1/2}(i+1/2,j)-H_{y}^{n+1/2}(i-1/2,j)) \\
 -\frac{2\epsilon_{0}\Delta t}{\Delta_{y}(\sigma_{x}\Delta t+2\epsilon_{0}\kappa_{x})}(H_{x}^{n+1/2}(i,j+1/2)-H_{x}^{n+1/2}(i,j-1/2))
\end{multlined}
\end{equation}

 
 Update Components for E\\

 Start with rewriting \ref{DzEzRelation}:
 \begin{equation}s_{z}D_{z}=\epsilon s_{y}E_{z}\end{equation}

 Using \ref{SyEquation} and \ref{SzEquation}:

 \begin{equation}(\kappa_{z}+\frac{\sigma_{z}}{j\omega\epsilon_{0}})D_{z}=\epsilon
   (\kappa_{y}+\frac{\sigma_{y}}{j\omega\epsilon_{0}})E_{z}\end{equation}

 Take the partial time derivative and use $\frac{\partial}{\partial t}= j \omega$
 
 \begin{equation}
   \frac{\partial}{\partial t}(\kappa_{z}D_{z})+\frac{\sigma_{z}}{\epsilon_{0}}D_{z}=
   \epsilon(\frac{\partial}{\partial t}(\kappa_{y}E_{z})+\frac{\sigma_{y}}{\epsilon_{0}}E_{z})
 \end{equation}



 
 \begin{equation}
   \frac{\partial}{\partial t}(\kappa_{z}D_{z})+\frac{\sigma_{z}}{\epsilon_{0}}D_{z}=
   \epsilon(\frac{\partial}{\partial t}(\kappa_{y}E_{z})+\frac{\sigma_{y}}{\epsilon_{0}}E_{z})
 \end{equation}
\\
Update Components for B\\
Update Components for H

\subsection{Graded Conductivity}

Reflection Factor
\[R(\theta)=\exp^{-2\eta cos(\theta)\int_{0}^{d}\sigma_{x}(x)dx\]

  Where $\sigma_{x}$ is the graded conductivity of the PML material.\\
  $\theta$ is the angle of incidence of the wave. So steeper angles of $\theta$
  will result in higher values of reflection error.\\
We want to minimize relfection R but also make sure the wave decays completely
in the PML boundary layer.

We are going to compare the error for different types of grading profiles.
And/or we can use different values in the grading profile 

\subsubsection{Polynomial grading}
Where the graded conductivity is:
\[\sigma_{x} = (\frac{x}{d})^{m} \sigma_{x,max}\]
And the graded value for $\kappa_{x}$ is:
\[\kappa_{x}=1+(\kappa_{x,max}-1)(\frac{x}{d})^{m}\]
Reflection factor simplifies to 

\subsubsection{Geometric grading}
Where the graded conductivity is:
\[\sigma_{x} =(g^{\frac{1}{\Delta}})^{x} \sigma_{x,0}\]

$\sigma_{x,0}$ is the conductivity at the surface of the PML.\\
g is a scaling factor. Nearly optimal: $2 \leq g \leq 3$\\
$\Delta$ is spacing of FDTD lattice.\\

And the graded value for $\kappa_{x}$ is:
\[\kappa_{x}=[(\kappa_{max})^{\frac{1}{d}}g^{\frac{1}{\Delta}}]^{x}\]

\section{Code}


\section{Error Analysis}
Insert Error Analysis Here

PMLs are exact for continuous functions, but error is introduced for discrete
functions. Having a large step discontinuity can

\subsubsection{Error of Polynomial Grading}

\subsubsection{Error of Geometric Grading}

\section{Fix me: Bibliography}
Susan's book - third edition

\end{document}